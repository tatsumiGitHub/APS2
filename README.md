# APS2
指定された構文で書かれたスクリプトファイルをもとに，
マウスやキーボード制御を行い，
操作の自動化を実現するプログラムです．

**本プログラムを用いて行う一切の行為，被った損害・損失に対しては，一切の責任を負いかねます**

## 導入とビルド

### 1. 実行環境
このプログラムの実行に求められる環境は以下の通りです．
```
 java 17.0.7 2023-04-18 LTS
 Java(TM) SE Runtime Environment (build 17.0.7+8-LTS-224)
 Java HotSpot(TM) 64-Bit Server VM (build 17.0.7+8-LTS-224, mixed mode, sharing)
```

### 2. ビルド
特別な操作を必要とせず，このプログラムをビルドすることが可能です．
以下の操作により，ビルドが可能です．
```
make
```
jarファイルを生成するには，以下の操作を実行してください．
```
make jar
```
ビルドをクリーンアップするには，以下の操作を実行してください．
```
make clean
```

### 3. 実行
このプログラムは実行時に，
実行に必要なファイル（スクリプトファイルを除く）とディレクトリをプログラムが存在するディレクトリ内に生成するため，
予め各種ファイル・ディレクトリを用意する必要がありません．

- setup.config（プログラムの設定を記述するファイル，起動時に生成される）
- log（ログファイルを出力するディレクトリ，実行時に生成される）

## setup.config
プログラムの設定を記述するファイルです．
以下の項目を設定します．
なお，斜体で記述された箇所は補足の説明になります．

|項目名|内容|
|-|-|
|UserName|ユーザ名|
|width|ウィンドウの幅 *int*|
|height|ウィンドウの高さ *int*|
|loop|スクリプトファイルに記述された操作を繰り返す回数 *int*|
|interval|操作間の待機時間 *ミリ秒*|
|path|起動時に設定されるスクリプトファイルのパス|
|close|操作完了時に閉じるボタンを押す操作を実行するか *yes／noで指定*|
|close-button-position|閉じるボタンのX座標 *int*, 閉じるボタンのY座標 *int*, 閉じるボタンを押す回数 *int*|
|Notification|LINE Notifyへの通知 *yes／noで指定*|
|social_media|"LINE"と記入してください|
|access_token|LINE Notifyのアクセストークン|

## スクリプトファイル
マウス・キーボード制御により自動化する操作を記述するファイルです．
スクリプトファイルの拡張子はdatである必要があります．
なお，スクリプトファイルは"<手続き名>:<引数または演算>"の構文で記述されます．
以下に手続きの種類を示します．

### 手続きの種類
| 手続き名 | 引数 | 内容 |
| - | - | - |
|begin| |ブロック文の開始位置を示します．|
|click|left／right,(X座標 *int*,Y座標 *int*,クリック回数 *=1,int,省略可*)|引数に指定された位置でクリック回数だけ左／右クリックを実行します．<br>なお，クリック回数に0を指定された場合，カーソルの移動のみを実行します．|
|end| |ブロック分の終了位置を示します．|
|loop|ループ回数 *int*|引数に指定された回数だけ，ブロック文の操作を繰り返します．|
|source|スクリプト名|実行されるスクリプト名を設定します．|
|var|<変数>=<演算>|計算式の右辺の変数を宣言し，その変数に左辺の演算結果を代入します．|
|wheel|up／down,回転量 *int*|引数に指定された回転量で上／下にホイールします．|
|wait|<条件>,<操作>,待機時間 *int,ミリ秒*／閾値 *float,0<x<1*|後述|

#### 手続き"wait"の引数について
手続き"wait"は第1引数と第2引数によって，操作の内容が大きく異なる手続きです．
第1引数に"null"が指定された場合，操作を一時停止する手続きとして実行されます．
しかし，第1引数に"cmp_screen_cursor_move"または"cmp_screen"を指定された場合，
setup.configで指定した"interval"の間隔で画面を比較し，
その一致率が第3引数に指定された閾値より小さい間，
操作を一時停止する手続きとして実行されます，
第1引数の詳細は，以下に示すとおりです．

| 第1引数 | 第2引数,第3引数 | 内容 |
| - | - |-|
|cmp_screen_cursor_move|(X座標 *int*,Y座標 *int*,範囲 *int*),閾値 *float,0<x<1*|"interval"の間隔で画面を比較し，その一致率が閾値より小さい間，操作を一時停止する．<br>なお，画像を比較する際，第2引数に指定されたX座標とY座標を中心とする範囲でカーソルを動かす．|
|cmp_screen|null,閾値 *float,0<x<1*|"interval"の間隔で画面を比較し，その一致率が閾値より小さい間，操作を一時停止する．|
|null|null,待機時間 *int,ミリ秒*|待機時間だけ，操作を一時停止します．|

### 演算について
演算では四則演算，剰余，グループ化，負の数をサポートしている．
| 演算 | 演算記号 |
| - | - |
|加算|+|
|減算|-|
|乗算|*|
|除算|/|
|剰余|%|
|グループ化開始記号|(|
|グループ化終了記号|)|
|負の数|-|

### 記述例
```
source: sample
 var: sleep_time = 1000 * (1 + 2)
 click: left,(0,0)
 wait:  null,null,sleep_time
 click: left,(150,150,2)
```
